<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>检测历史 - 新技术专题（2）</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <!-- Google Fonts & FontAwesome -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-top-content">
                <h2><i class="fa-solid fa-robot"></i> 新技术专题（2）无人机检测平台</h2>
                <img src="{{ url_for('static', filename='YOLO-Drone.png') }}" alt="YOLO-Drone Logo" class="header-logo">
            </div>
            <br>
            <h2><i class="fa-solid fa-user"></i> 任课老师：金鑫</h2>
        </div>

        <nav class="nav-menu">
            <a href="{{ url_for('index') }}" class="nav-link">
                <i class="fas fa-camera"></i> 实时检测
            </a>
            <a href="{{ url_for('history') }}" class="nav-link active">
                <i class="fas fa-history"></i> 检测历史
            </a>
            <a href="{{ url_for('about') }}" class="nav-link">
                <i class="fas fa-info-circle"></i> 关于我们
            </a>
        </nav>

        <div class="history-section">
            <h3>检测历史记录</h3>
            <div class="clear-history-container">
                <button type="button" class="clear-history-button" id="clearHistoryBtn">
                    <i class="fas fa-trash-alt"></i> 清除所有历史记录
                </button>
            </div>
            <div class="history-grid">
                {% for record in history_records %}
                <div class="history-item">
                    <img src="{{ url_for('static', filename=record.image_url) }}" alt="检测结果">
                    <div class="history-item-info">
                        <h4>{{ record.date }}</h4>
                        <p>检测目标数：{{ record.total_objects }}</p>
                        <p>主要类别：{{ record.main_classes|join(', ') }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- 确认弹窗 -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <h3>确认清除</h3>
                <p>您确定要清除所有历史记录吗？此操作不可逆。</p>
                <div class="modal-buttons">
                    <button id="confirmBtn" class="modal-button confirm-button">确认</button>
                    <button id="cancelBtn" class="modal-button cancel-button">取消</button>
                </div>
            </div>
        </div>

        <div class="team-info">
            <h3><i class="fas fa-users"></i> 无人机检测小组</h3>
            <p><i class="fas fa-user-secret"></i> 组长：聂宇旋</p>
            <p><i class="fas fa-user-friends"></i> 组员：宋禹彤、张嘉文</p>
            <p><i class="fas fa-pen-nib"></i> 作者：<a href="https://github.com/Echo-Nie?tab=repositories"
                    class="author-link" target="_blank">Echo-Nie</a></p>
            <p><i class="fas fa-globe"></i> 平台搭建所需图标参考网站：<a href="https://fontawesome.com/" class="author-link"
                    target="_blank">fontawesome官方网站</a>
            </p>
        </div>
    </div>
    <!-- 自定义脚本 -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('页面加载完成');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const confirmModal = document.getElementById('confirmModal');
            const confirmBtn = document.getElementById('confirmBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const historyGrid = document.querySelector('.history-grid');

            if (clearHistoryBtn) {
                console.log('找到清除按钮');
                clearHistoryBtn.addEventListener('click', function () {
                    console.log('按钮被点击');
                    // 检查是否有历史记录
                    if (!historyGrid || historyGrid.children.length === 0) {
                        // 显示提示消息
                        const msgDiv = document.createElement('div');
                        msgDiv.className = 'msg center-popup-message';
                        msgDiv.innerHTML = '暂无历史记录可清除';
                        document.body.appendChild(msgDiv);

                        // 添加动画效果
                        msgDiv.style.opacity = '0';
                        msgDiv.style.transform = 'translate(-50%, -60px)';

                        setTimeout(() => {
                            msgDiv.style.transition = 'all 0.4s ease-out';
                            msgDiv.style.opacity = '1';
                            msgDiv.style.transform = 'translate(-50%, -50%)';
                        }, 50);

                        // 2秒后自动消失
                        setTimeout(() => {
                            msgDiv.style.opacity = '0';
                            msgDiv.style.transform = 'translate(-50%, -40px)';
                            setTimeout(() => msgDiv.remove(), 400);
                        }, 2000);
                        return;
                    }
                    confirmModal.style.display = 'flex';
                });
            }

            if (confirmBtn) {
                console.log('找到确认按钮');
                confirmBtn.addEventListener('click', function () {
                    console.log('确认按钮被点击');
                    // 创建并提交表单
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/clear_history';
                    document.body.appendChild(form);
                    form.submit();
                });
            }

            if (cancelBtn) {
                console.log('找到取消按钮');
                cancelBtn.addEventListener('click', function () {
                    console.log('取消按钮被点击');
                    confirmModal.style.display = 'none';
                });
            }

            // 点击模态框外部关闭
            window.addEventListener('click', function (event) {
                if (event.target === confirmModal) {
                    confirmModal.style.display = 'none';
                }
            });
        });
    </script>
</body>

</html>